<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduQuery SG - Singapore Schools Database</title>
  
  <!-- Leaflet CSS for Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Main Styles -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Map Styles -->
  <link rel="stylesheet" href="map_style.css">
  
  <!-- Analytics Styles -->
  <link rel="stylesheet" href="analytics.css">

  <!-- Advance_Search Styles (within index page)-->
  <link rel="stylesheet" href="advanced_search.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <h1>EduQuery SG</h1>
        </div>
        <nav class="nav">
          <button class="nav-btn active" data-view="search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
            </svg>
            Search
          </button>
          <button class="nav-btn" data-view="manage">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
            </svg>
            Manage
          </button>
          <button class="nav-btn" data-view="map">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.919 4.633l-4.553 4.553-2.359-2.359 4.553-4.553c.649-.649 1.701-.649 2.359 0 .649.649.649 1.701 0 2.359zM2 11.793V16h4.207l7.921-7.921-4.207-4.207L2 11.793z"/>
            </svg>
            Map
          </button>
          <button class="nav-btn" data-view="analytics">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
            </svg>
            Analytics
          </button>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="container">
      
      <!-- Search View -->
      <div id="searchView" class="view active">
  <!-- Search Section -->
  <section class="search-section">
    <div class="search-card">
      <h2 class="section-title">Find Schools in Singapore</h2>
      <p class="section-subtitle">Search across all schools, subjects, CCAs, programmes & distinctives</p>
      
      <div class="search-controls">
        <div class="search-input-wrapper">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
          </svg>
          <input type="text" id="searchBox" class="search-input" placeholder="Search for anything (e.g., Raffles, Basketball, Science)">
          <button id="clearSearchBtn" class="clear-search-btn" onclick="clearSearch()" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
            </svg>
          </button>
          <div id="searchSuggestions" class="search-results"></div>
        </div>
        
        <div class="filter-group">
          <label for="queryType" class="filter-label">Search Mode</label>
          <select id="queryType" class="filter-select">
            <option value="universal">Universal (All Categories)</option>
            <option value="all">Schools Only</option>
            <option value="subjects">Subjects Only</option>
            <option value="ccas">CCAs Only</option>
            <option value="programmes">Programmes Only</option>
            <option value="distinctives">Distinctives Only</option>
          </select>
        </div>
        
        <button onclick="runQuery()" class="btn-primary">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
          </svg>
          Search
        </button>
      </div>

      <!-- Advanced Search Link -->
      <div> <!-- style="text-align: right; margin-top: 16px/5%;" -->
        <button onclick="showAdvancedSearch()" class="btn-link">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
          </svg>
          Advanced Search
        </button>
      </div>

      <button onclick="startComparisonMode()" class="btn-link" style="margin-left: 12px;">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
          <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5z"/>
        </svg>
        Compare Schools
      </button>

      <button onclick="showDistanceSearch()" class="btn-link" style="margin-left: 12px;">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
        </svg>
        Search by Distance
      </button>

      <!-- Search Tips -->
      <div class="search-tips">
        <div class="tip-item">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
          </svg>
          <span><strong>Universal Search</strong> searches everything at once - perfect for exploring!</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Results Section -->
  <section class="results-section">
    <div class="results-header">
      <h2 class="section-title">Results</h2>
      <div id="resultsMeta" class="results-meta"></div>
    </div>
    
    <!-- Universal Search Summary -->
    <div id="universalSearchSummary" class="search-summary" style="display: none;">
      <div class="summary-stats">
        <div class="summary-stat">
          <span class="stat-label">Total Results</span>
          <span class="stat-value" id="totalResults">0</span>
        </div>
        <div class="summary-stat">
          <span class="stat-label">Schools</span>
          <span class="stat-value" id="schoolResults">0</span>
        </div>
        <div class="summary-stat">
          <span class="stat-label">Subjects</span>
          <span class="stat-value" id="subjectResults">0</span>
        </div>
        <div class="summary-stat">
          <span class="stat-label">CCAs</span>
          <span class="stat-value" id="ccaResults">0</span>
        </div>
        <div class="summary-stat">
          <span class="stat-label">Programmes</span>
          <span class="stat-value" id="programmeResults">0</span>
        </div>
        <div class="summary-stat">
          <span class="stat-label">Distinctives</span>
          <span class="stat-value" id="distinctiveResults">0</span>
        </div>
      </div>
    </div>
    
    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
      <div class="spinner"></div>
      <p>Searching database...</p>
    </div>
    
    <div id="resultsTable" class="results-container">
      <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="32" r="30" stroke="#E5E7EB" stroke-width="4"/>
          <path d="M32 20v24M20 32h24" stroke="#E5E7EB" stroke-width="4" stroke-linecap="round"/>
        </svg>
        <h3>No search performed yet</h3>
        <p>Try searching for a school name, subject, CCA, or programme</p>
      </div>
    </div>
  </section>
</div>

      <!-- Manage View -->
      <div id="manageView" class="view">
        <section class="manage-section">
          <div class="manage-header">
            <div>
              <h2 class="section-title">Manage Schools</h2>
              <p class="section-subtitle">Add new schools to the database</p>
            </div>
            <button onclick="showAddModal()" class="btn-primary">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"/>
              </svg>
              Add New School
            </button>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon" style="background: #DBEAFE;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#2563EB">
                  <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                </svg>
              </div>
              <div class="stat-content">
                <h3 class="stat-label">Total Schools</h3>
                <p class="stat-value" id="totalSchools">-</p>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon" style="background: #DCFCE7;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#16A34A">
                  <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
              </div>
              <div class="stat-content">
                <h3 class="stat-label">Recent Additions</h3>
                <p class="stat-value">0</p>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon" style="background: #FEF3C7;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#CA8A04">
                  <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                </svg>
              </div>
              <div class="stat-content">
                <h3 class="stat-label">Last Updated</h3>
                <p class="stat-value">Today</p>
              </div>
            </div>
          </div>

          <div class="info-card">
            <div>
              <h4>Database Management</h4>
              <p>Add new schools to the EduQuery database. All fields are required to ensure data integrity. Changes are saved immediately to both PostgreSQL and MongoDB.</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Map View -->
      <div id="mapView" class="view">
        <section class="map-container">
          <h2 class="section-title">Singapore Schools Map</h2>
          <p class="section-subtitle">Interactive map showing all schools by location</p>
          
          <!-- Statistics -->
          <div class="map-stats">
            <div class="map-stat">
              <div class="map-stat-label">Total Schools</div>
              <div class="map-stat-value" id="totalSchoolsMap">0</div>
            </div>
            <div class="map-stat">
              <div class="map-stat-label">Mapped Schools</div>
              <div class="map-stat-value" id="mappedSchools">0</div>
            </div>
            <div class="map-stat">
              <div class="map-stat-label">Selected Zone</div>
              <div class="map-stat-value" id="selectedZone">All</div>
            </div>
          </div>

          <!-- Filter Chips -->
          <div class="filter-chips">
            <div class="chip active" data-zone="all">All Zones</div>
            <div class="chip" data-zone="NORTH">North</div>
            <div class="chip" data-zone="SOUTH">South</div>
            <div class="chip" data-zone="EAST">East</div>
            <div class="chip" data-zone="WEST">West</div>
            <div class="chip" data-zone="CENTRAL">Central</div>
          </div>

          <!-- Search Box -->
          <div class="map-search-container">
            <div class="search-input-wrapper">
              <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
              </svg>
              <input type="text" id="mapSearchBox" class="search-input" placeholder="Search for a school..." onkeyup="searchSchoolsOnMap(event)">
              <button id="clearSearchBtn" class="clear-search-btn" onclick="clearMapSearch()" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                </svg>
              </button>
            </div>
            <div id="searchResults" class="search-results"></div>
          </div>

          <!-- Map Controls -->
          <div class="map-controls">
            <button class="btn-primary" onclick="loadSchoolsMap()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z"/>
              </svg>
              Refresh Map
            </button>
            <button class="btn-secondary" onclick="resetMapView()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM10 5v5l3.28 1.97-.52.87L9 10.5V5h1z"/>
              </svg>
              Reset View
            </button>
          </div>

          <!-- Map -->
          <div style="position: relative;">
            <div id="map"></div>
            <div id="mapLoading" class="loading-overlay" style="display: none;">
              <div class="loading-spinner">
                <div class="spinner"></div>
                <p>Loading school locations...</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Legend -->
        <section class="map-container">
          <h3 style="margin-bottom: 16px;">Map Legend</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #3B82F6; border-radius: 50%;"></div>
              <span>North Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #10B981; border-radius: 50%;"></div>
              <span>South Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #F59E0B; border-radius: 50%;"></div>
              <span>East Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #EF4444; border-radius: 50%;"></div>
              <span>West Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #8B5CF6; border-radius: 50%;"></div>
              <span>Central Zone</span>
            </div>
          </div>
        </section>
      </div>

      <!-- Analytics View -->
      <div id="analyticsView" class="view">
        <section class="analytics-section">
          <div class="analytics-header">
            <div>
              <h2 class="section-title">Analytics & Insights</h2>
              <p class="section-subtitle">Complex database queries and statistical analysis</p>
            </div>
          </div>

          <!-- Analytics Dashboard Cards -->
          <div class="analytics-cards">
            
            <!-- Card 1: Zone Statistics -->
            <div class="analytics-card">
              <div class="card-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                  </svg>
                  Schools by Zone
                </h3>
                <button class="btn-icon" onclick="loadZoneStatistics()">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                  </svg>
                </button>
              </div>
              <div id="zoneStatsContent" class="card-content">
                <div class="loading-placeholder">Click refresh to load data</div>
              </div>
            </div>

            <!-- Card 2: Subject Diversity -->
            <div class="analytics-card">
              <div class="card-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                  </svg>
                  Subject Diversity
                </h3>
                <button class="btn-icon" onclick="loadSubjectCount()">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                  </svg>
                </button>
              </div>
              <div id="subjectCountContent" class="card-content">
                <div class="loading-placeholder">Click refresh to load data</div>
              </div>
            </div>

            <!-- Card 3: Above Average Schools -->
            <div class="analytics-card">
              <div class="card-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                  Above Average Schools
                </h3>
                <button class="btn-icon" onclick="loadAboveAverage()">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                  </svg>
                </button>
              </div>
              <div id="aboveAverageContent" class="card-content">
                <div class="loading-placeholder">Click refresh to load data</div>
              </div>
            </div>

            <!-- Card 4: CCA Participation -->
            <div class="analytics-card">
              <div class="card-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                  </svg>
                  CCA Participation
                </h3>
                <button class="btn-icon" onclick="loadCCAParticipation()">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                  </svg>
                </button>
              </div>
              <div id="ccaParticipationContent" class="card-content">
                <div class="loading-placeholder">Click refresh to load data</div>
              </div>
            </div>

            <!-- Card 5: Data Completeness -->
            <div class="analytics-card">
              <div class="card-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                  </svg>
                  Data Completeness
                </h3>
                <button class="btn-icon" onclick="loadDataCompleteness()">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                  </svg>
                </button>
              </div>
              <div id="dataCompletenessContent" class="card-content">
                <div class="loading-placeholder">Click refresh to load data</div>
              </div>
            </div>

            <!-- Card 6: Zone Comparison -->
            <div class="analytics-card full-width">
              <div class="card-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
                  </svg>
                  Zone Comparison Analysis
                </h3>
                <button class="btn-icon" onclick="loadZoneComparison()">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                  </svg>
                </button>
              </div>
              <div id="zoneComparisonContent" class="card-content">
                <div class="loading-placeholder">Click refresh to load data</div>
              </div>
            </div>

          </div>

          <!-- Load All Button -->
          <div style="margin-top: 32px; text-align: center;">
            <button class="btn-primary" onclick="loadAllAnalytics()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"/>
              </svg>
              Load All Analytics
            </button>
          </div>

        </section>
      </div>
  

    </div>
  </main>

  <!-- Add School Modal -->
  <div id="addModal" class="modal">
    <div class="modal-overlay" onclick="hideAddModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New School</h3>
        <button class="modal-close" onclick="hideAddModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <form id="addSchoolForm" onsubmit="addSchool(event)">
        <div class="form-grid">
          <div class="form-group">
            <label for="schoolName">School Name *</label>
            <input type="text" id="schoolName" required placeholder="e.g., Anderson Secondary School">
          </div>

          <div class="form-group">
            <label for="principalName">Principal Name *</label>
            <input type="text" id="principalName" required placeholder="e.g., Mrs. Tan Bee Leng">
          </div>

          <div class="form-group full-width">
            <label for="address">Address *</label>
            <input type="text" id="address" required placeholder="e.g., 4650 Ang Mo Kio Avenue 6">
          </div>

          <div class="form-group">
            <label for="postalCode">Postal Code *</label>
            <input type="text" id="postalCode" required pattern="[0-9]{6}" placeholder="e.g., 569842">
            <span class="form-hint">6 digits</span>
          </div>

          <div class="form-group">
            <label for="zoneCode">Zone Code *</label>
            <select id="zoneCode" required>
              <option value="">Select zone...</option>
              <option value="NORTH">North</option>
              <option value="SOUTH">South</option>
              <option value="EAST">East</option>
              <option value="WEST">West</option>
              <option value="CENTRAL">Central</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label for="mainlevelCode">Main Level *</label>
            <select id="mainlevelCode" required>
              <option value="">Select level...</option>
              <option value="PRIMARY">Primary</option>
              <option value="SECONDARY">Secondary</option>
              <option value="JUNIOR COLLEGE">Junior College</option>
              <option value="CENTRALISED INSTITUTE">Centralised Institute</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="hideAddModal()">Cancel</button>
          <button type="submit" class="btn-primary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
            Save School
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit School Modal -->
  <div id="editModal" class="modal">
    <div class="modal-overlay" onclick="hideEditModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit School</h3>
        <button class="modal-close" onclick="hideEditModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <form id="editSchoolForm" onsubmit="updateSchool(event)">
        <input type="hidden" id="editSchoolId">
        
        <div class="form-grid">
          <div class="form-group">
            <label for="editSchoolName">School Name *</label>
            <input type="text" id="editSchoolName" required placeholder="e.g., Anderson Secondary School">
          </div>

          <div class="form-group">
            <label for="editPrincipalName">Principal Name *</label>
            <input type="text" id="editPrincipalName" required placeholder="e.g., Mrs. Tan Bee Leng">
          </div>

          <div class="form-group full-width">
            <label for="editAddress">Address *</label>
            <input type="text" id="editAddress" required placeholder="e.g., 4650 Ang Mo Kio Avenue 6">
          </div>

          <div class="form-group">
            <label for="editPostalCode">Postal Code *</label>
            <input type="text" id="editPostalCode" required pattern="[0-9]{6}" placeholder="e.g., 569842">
            <span class="form-hint">6 digits</span>
          </div>

          <div class="form-group">
            <label for="editZoneCode">Zone Code *</label>
            <select id="editZoneCode" required>
              <option value="">Select zone...</option>
              <option value="NORTH">North</option>
              <option value="SOUTH">South</option>
              <option value="EAST">East</option>
              <option value="WEST">West</option>
              <option value="CENTRAL">Central</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label for="editMainlevelCode">Main Level *</label>
            <select id="editMainlevelCode" required>
              <option value="">Select level...</option>
              <option value="PRIMARY">Primary</option>
              <option value="SECONDARY">Secondary</option>
              <option value="JUNIOR COLLEGE">Junior College</option>
              <option value="CENTRALISED INSTITUTE">Centralised Institute</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="hideEditModal()">Cancel</button>
          <button type="submit" class="btn-primary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
            Update School
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-overlay" onclick="hideDeleteModal()"></div>
    <div class="modal-content" style="max-width: 450px;">
      <div class="modal-header">
        <h3>Delete School</h3>
        <button class="modal-close" onclick="hideDeleteModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <div class="delete-modal-body">
        <p class="delete-warning">
          Are you sure you want to delete <strong id="deleteSchoolName"></strong>?
        </p>
        <div class="delete-info">
          <p>This will permanently delete:</p>
          <ul>
            <li>The school record</li>
            <li>All associated subjects</li>
            <li>All associated CCAs</li>
            <li>All associated programmes</li>
            <li>All distinctive programmes</li>
          </ul>
          <p class="delete-note">This action cannot be undone.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" onclick="hideDeleteModal()">Cancel</button>
        <button type="button" class="btn-danger" onclick="confirmDelete()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
          </svg>
          Delete School
        </button>
      </div>
    </div>
  </div>


    <!-- Advanced Search Modal -->
  <div id="advancedSearchModal" class="modal">
    <div class="modal-overlay" onclick="hideAdvancedSearch()"></div>
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>Advanced Search</h3>
        <button class="modal-close" onclick="hideAdvancedSearch()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <form id="advancedSearchForm" onsubmit="runAdvancedQuery(event)">
        <div class="advanced-search-body">
          
          <!-- School Information Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">School Information</h4>
            <div class="form-grid">
              <div class="form-group">
                <label for="adv_school_name">School Name</label>
                <input type="text" id="adv_school_name" placeholder="e.g., Anderson Secondary">
              </div>

              <div class="form-group">
                <label for="adv_principal_name">Principal Name</label>
                <input type="text" id="adv_principal_name" placeholder="e.g., Mrs. Tan">
              </div>

              <div class="form-group">
                <label for="adv_vp_name">Vice Principal Name</label>
                <input type="text" id="adv_vp_name" placeholder="e.g., Mr. Lee">
              </div>

              <div class="form-group">
                <label for="adv_email">Email Address</label>
                <input type="email" id="adv_email" placeholder="e.g., school@moe.edu.sg">
              </div>

              <div class="form-group full-width">
                <label for="adv_address">Address</label>
                <input type="text" id="adv_address" placeholder="e.g., Ang Mo Kio Avenue 6">
              </div>

              <div class="form-group">
                <label for="adv_postal_code">Postal Code</label>
                <input type="text" id="adv_postal_code" placeholder="6-digit code" pattern="[0-9]{6}">
              </div>
            </div>
          </div>

          <!-- School Classification Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">School Classification</h4>
            <div class="form-grid">
              <div class="form-group">
                <label for="adv_zone_code">Zone</label>
                <select id="adv_zone_code">
                  <option value="">All Zones</option>
                  <option value="NORTH">North</option>
                  <option value="SOUTH">South</option>
                  <option value="EAST">East</option>
                  <option value="WEST">West</option>
                  <option value="CENTRAL">Central</option>
                </select>
              </div>

              <div class="form-group">
                <label for="adv_mainlevel_code">Main Level</label>
                <select id="adv_mainlevel_code">
                  <option value="">All Levels</option>
                  <option value="PRIMARY">Primary</option>
                  <option value="SECONDARY">Secondary</option>
                  <option value="JUNIOR COLLEGE">Junior College</option>
                  <option value="CENTRALISED INSTITUTE">Centralised Institute</option>
                </select>
              </div>

              <div class="form-group">
                <label for="adv_type_code">School Type</label>
                <input type="text" id="adv_type_code" placeholder="e.g., GOVERNMENT">
              </div>

              <div class="form-group">
                <label for="adv_nature_code">Nature Code</label>
                <input type="text" id="adv_nature_code" placeholder="e.g., CO-ED">
              </div>

              <div class="form-group">
                <label for="adv_school_section">School Section</label>
                <input type="text" id="adv_school_section" placeholder="e.g., MAINSTREAM">
              </div>

              <div class="form-group">
                <label for="adv_session_code">Session Code</label>
                <input type="text" id="adv_session_code" placeholder="e.g., AM/PM">
              </div>

              <div class="form-group">
                <label for="adv_dgp_code">DGP Code</label>
                <input type="text" id="adv_dgp_code" placeholder="DGP classification">
              </div>

              <div class="form-group">
                <label for="adv_mothertongue_code">Mother Tongue Code</label>
                <input type="text" id="adv_mothertongue_code" placeholder="e.g., Malay/Chinese/Tamil">
              </div>
            </div>
          </div>

          <!-- Special Programmes Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">Special Programmes & Indicators</h4>
            <div class="form-grid">
              <div class="form-group">
                <label for="adv_autonomous_ind">Autonomous School</label>
                <select id="adv_autonomous_ind">
                  <option value="">Any</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div class="form-group">
                <label for="adv_gifted_ind">Gifted Programme</label>
                <select id="adv_gifted_ind">
                  <option value="">Any</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div class="form-group">
                <label for="adv_ip_ind">Integrated Programme</label>
                <select id="adv_ip_ind">
                  <option value="">Any</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div class="form-group">
                <label for="adv_sap_ind">SAP School</label>
                <select id="adv_sap_ind">
                  <option value="">Any</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div class="form-group full-width">
                <label for="adv_moe_programme_desc">MOE Programme</label>
                <input type="text" id="adv_moe_programme_desc" placeholder="e.g., Applied Learning Programme">
              </div>
            </div>
          </div>

          <!-- ALP Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">Applied Learning Programme (ALP)</h4>
            <div class="form-grid">
              <div class="form-group">
                <label for="adv_alp_domain">ALP Domain</label>
                <input type="text" id="adv_alp_domain" placeholder="e.g., Science, Technology">
              </div>

              <div class="form-group full-width">
                <label for="adv_alp_title">ALP Title</label>
                <input type="text" id="adv_alp_title" placeholder="ALP programme title">
              </div>
            </div>
          </div>

          <!-- LLP Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">Learning for Life Programme (LLP)</h4>
            <div class="form-grid">
              <div class="form-group">
                <label for="adv_llp_domain1">LLP Domain</label>
                <input type="text" id="adv_llp_domain1" placeholder="e.g., Sports, Arts">
              </div>

              <div class="form-group full-width">
                <label for="adv_llp_title">LLP Title</label>
                <input type="text" id="adv_llp_title" placeholder="LLP programme title">
              </div>
            </div>
          </div>

          <!-- Subjects & CCAs Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">Subjects & Co-Curricular Activities</h4>
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="adv_subject_desc">Subject</label>
                <input type="text" id="adv_subject_desc" placeholder="e.g., Physics, Mathematics">
              </div>

              <div class="form-group">
                <label for="adv_cca_generic_name">CCA Generic Name</label>
                <input type="text" id="adv_cca_generic_name" placeholder="e.g., Basketball">
              </div>

              <div class="form-group">
                <label for="adv_cca_customized_name">CCA Customized Name</label>
                <input type="text" id="adv_cca_customized_name" placeholder="School-specific CCA name">
              </div>

              <div class="form-group full-width">
                <label for="adv_cca_grouping_desc">CCA Grouping</label>
                <input type="text" id="adv_cca_grouping_desc" placeholder="e.g., Sports, Clubs & Societies">
              </div>
            </div>
          </div>

          <!-- Transportation Section -->
          <div class="search-section-group">
            <h4 class="search-section-title">Transportation</h4>
            <div class="form-grid">
              <div class="form-group">
                <label for="adv_bus_desc">Bus Services</label>
                <input type="text" id="adv_bus_desc" placeholder="e.g., 123, 456">
              </div>

              <div class="form-group">
                <label for="adv_mrt_desc">MRT Station</label>
                <input type="text" id="adv_mrt_desc" placeholder="e.g., Ang Mo Kio">
              </div>
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="clearAdvancedSearch()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z"/>
            </svg>
            Clear All
          </button>
          <button type="button" class="btn-secondary" onclick="hideAdvancedSearch()">Cancel</button>
          <button type="submit" class="btn-primary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
            </svg>
            Search
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <div class="toast-content">
      <span id="toastMessage"></span>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>INF2003 Database Systems Project • Built with PostgreSQL (Supabase) + MongoDB Atlas</p>
      <p class="footer-links">
        <a href="#" onclick="showAbout(); return false;">About</a>
        <span>•</span>
        <a href="#" onclick="showHelp(); return false;">Help</a>
      </p>
    </div>
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  
  <!-- Map Script -->
  <script src="map.js"></script>
    <!-- Main Script -->
  <script src="script.js"></script>
  <!-- Analytics Script -->
  <script src="analytics.js"></script>
  <!-- Advance_Search Script -->
  <script src="advanced_search.js"></script>
</body>
</html>