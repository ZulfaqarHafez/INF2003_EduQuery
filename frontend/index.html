<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduQuery SG - Singapore Schools Database</title>
  
  <!-- Leaflet CSS for Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Main Styles -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Map Styles -->
  <link rel="stylesheet" href="map_style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <h1>EduQuery SG</h1>
        </div>
        <nav class="nav">
          <button class="nav-btn active" data-view="search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
            </svg>
            Search
          </button>
          <button class="nav-btn" data-view="manage">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
            </svg>
            Manage
          </button>
          <button class="nav-btn" data-view="map">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.919 4.633l-4.553 4.553-2.359-2.359 4.553-4.553c.649-.649 1.701-.649 2.359 0 .649.649.649 1.701 0 2.359zM2 11.793V16h4.207l7.921-7.921-4.207-4.207L2 11.793z"/>
            </svg>
            Map
          </button>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="container">
      
      <!-- Search View -->
      <div id="searchView" class="view active">
        <!-- Search Section -->
        <section class="search-section">
          <div class="search-card">
            <h2 class="section-title">Find Schools in Singapore</h2>
            <p class="section-subtitle">Search by school name and explore subjects, CCAs, programmes & more</p>
            
            <div class="search-controls">
              <div class="search-input-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
                </svg>
                <input type="text" id="searchBox" class="search-input" placeholder="Enter school name (e.g., Raffles, Anderson)">
              </div>
              
              <div class="filter-group">
                <label for="queryType" class="filter-label">Query Type</label>
                <select id="queryType" class="filter-select">
                  <option value="all">General Info</option>
                  <option value="subjects">Subjects</option>
                  <option value="ccas">CCAs</option>
                  <option value="programmes">Programmes</option>
                  <option value="distinctives">Distinctives (ALP/LLP)</option>
                </select>
              </div>
              
              <button onclick="runQuery()" class="btn-primary">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
                </svg>
                Search
              </button>
            </div>
          </div>
        </section>

        <!-- Results Section -->
        <section class="results-section">
          <div class="results-header">
            <h2 class="section-title">Results</h2>
            <div id="resultsMeta" class="results-meta"></div>
          </div>
          
          <div id="loadingSpinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Searching database...</p>
          </div>
          
          <div id="resultsTable" class="results-container">
            <div class="empty-state">
              <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                <circle cx="32" cy="32" r="30" stroke="#E5E7EB" stroke-width="4"/>
                <path d="M32 20v24M20 32h24" stroke="#E5E7EB" stroke-width="4" stroke-linecap="round"/>
              </svg>
              <h3>No search performed yet</h3>
              <p>Enter a school name and select a query type to begin</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Manage View -->
      <div id="manageView" class="view">
        <section class="manage-section">
          <div class="manage-header">
            <div>
              <h2 class="section-title">Manage Schools</h2>
              <p class="section-subtitle">Add new schools to the database</p>
            </div>
            <button onclick="showAddModal()" class="btn-primary">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"/>
              </svg>
              Add New School
            </button>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon" style="background: #DBEAFE;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#2563EB">
                  <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                </svg>
              </div>
              <div class="stat-content">
                <h3 class="stat-label">Total Schools</h3>
                <p class="stat-value" id="totalSchools">-</p>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon" style="background: #DCFCE7;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#16A34A">
                  <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
              </div>
              <div class="stat-content">
                <h3 class="stat-label">Recent Additions</h3>
                <p class="stat-value">0</p>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon" style="background: #FEF3C7;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#CA8A04">
                  <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                </svg>
              </div>
              <div class="stat-content">
                <h3 class="stat-label">Last Updated</h3>
                <p class="stat-value">Today</p>
              </div>
            </div>
          </div>

          <div class="info-card">
            <div>
              <h4>Database Management</h4>
              <p>Add new schools to the EduQuery database. All fields are required to ensure data integrity. Changes are saved immediately to both PostgreSQL and MongoDB.</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Map View -->
      <div id="mapView" class="view">
        <section class="map-container">
          <h2 class="section-title">Singapore Schools Map</h2>
          <p class="section-subtitle">Interactive map showing all schools by location</p>
          
          <!-- Statistics -->
          <div class="map-stats">
            <div class="map-stat">
              <div class="map-stat-label">Total Schools</div>
              <div class="map-stat-value" id="totalSchoolsMap">0</div>
            </div>
            <div class="map-stat">
              <div class="map-stat-label">Mapped Schools</div>
              <div class="map-stat-value" id="mappedSchools">0</div>
            </div>
            <div class="map-stat">
              <div class="map-stat-label">Selected Zone</div>
              <div class="map-stat-value" id="selectedZone">All</div>
            </div>
          </div>

          <!-- Filter Chips -->
          <div class="filter-chips">
            <div class="chip active" data-zone="all">All Zones</div>
            <div class="chip" data-zone="NORTH">North</div>
            <div class="chip" data-zone="SOUTH">South</div>
            <div class="chip" data-zone="EAST">East</div>
            <div class="chip" data-zone="WEST">West</div>
            <div class="chip" data-zone="CENTRAL">Central</div>
          </div>

          <!-- Search Box -->
          <div class="map-search-container">
            <div class="search-input-wrapper">
              <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9 2a7 7 0 015.618 11.176l4.1 4.1a1 1 0 01-1.414 1.414l-4.1-4.1A7 7 0 119 2zm0 2a5 5 0 100 10 5 5 0 000-10z"/>
              </svg>
              <input type="text" id="mapSearchBox" class="search-input" placeholder="Search for a school..." onkeyup="searchSchoolsOnMap(event)">
              <button id="clearSearchBtn" class="clear-search-btn" onclick="clearMapSearch()" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                </svg>
              </button>
            </div>
            <div id="searchResults" class="search-results"></div>
          </div>

          <!-- Map Controls -->
          <div class="map-controls">
            <button class="btn-primary" onclick="loadSchoolsMap()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z"/>
              </svg>
              Refresh Map
            </button>
            <button class="btn-secondary" onclick="resetMapView()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM10 5v5l3.28 1.97-.52.87L9 10.5V5h1z"/>
              </svg>
              Reset View
            </button>
          </div>

          <!-- Map -->
          <div style="position: relative;">
            <div id="map"></div>
            <div id="mapLoading" class="loading-overlay" style="display: none;">
              <div class="loading-spinner">
                <div class="spinner"></div>
                <p>Loading school locations...</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Legend -->
        <section class="map-container">
          <h3 style="margin-bottom: 16px;">Map Legend</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #3B82F6; border-radius: 50%;"></div>
              <span>North Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #10B981; border-radius: 50%;"></div>
              <span>South Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #F59E0B; border-radius: 50%;"></div>
              <span>East Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #EF4444; border-radius: 50%;"></div>
              <span>West Zone</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 20px; background: #8B5CF6; border-radius: 50%;"></div>
              <span>Central Zone</span>
            </div>
          </div>
        </section>
      </div>

    </div>
  </main>

  <!-- Add School Modal -->
  <div id="addModal" class="modal">
    <div class="modal-overlay" onclick="hideAddModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New School</h3>
        <button class="modal-close" onclick="hideAddModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <form id="addSchoolForm" onsubmit="addSchool(event)">
        <div class="form-grid">
          <div class="form-group">
            <label for="schoolName">School Name *</label>
            <input type="text" id="schoolName" required placeholder="e.g., Anderson Secondary School">
          </div>

          <div class="form-group">
            <label for="principalName">Principal Name *</label>
            <input type="text" id="principalName" required placeholder="e.g., Mrs. Tan Bee Leng">
          </div>

          <div class="form-group full-width">
            <label for="address">Address *</label>
            <input type="text" id="address" required placeholder="e.g., 4650 Ang Mo Kio Avenue 6">
          </div>

          <div class="form-group">
            <label for="postalCode">Postal Code *</label>
            <input type="text" id="postalCode" required pattern="[0-9]{6}" placeholder="e.g., 569842">
            <span class="form-hint">6 digits</span>
          </div>

          <div class="form-group">
            <label for="zoneCode">Zone Code *</label>
            <select id="zoneCode" required>
              <option value="">Select zone...</option>
              <option value="NORTH">North</option>
              <option value="SOUTH">South</option>
              <option value="EAST">East</option>
              <option value="WEST">West</option>
              <option value="CENTRAL">Central</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label for="mainlevelCode">Main Level *</label>
            <select id="mainlevelCode" required>
              <option value="">Select level...</option>
              <option value="PRIMARY">Primary</option>
              <option value="SECONDARY">Secondary</option>
              <option value="JUNIOR COLLEGE">Junior College</option>
              <option value="CENTRALISED INSTITUTE">Centralised Institute</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="hideAddModal()">Cancel</button>
          <button type="submit" class="btn-primary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
            Save School
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit School Modal -->
  <div id="editModal" class="modal">
    <div class="modal-overlay" onclick="hideEditModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit School</h3>
        <button class="modal-close" onclick="hideEditModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <form id="editSchoolForm" onsubmit="updateSchool(event)">
        <input type="hidden" id="editSchoolId">
        
        <div class="form-grid">
          <div class="form-group">
            <label for="editSchoolName">School Name *</label>
            <input type="text" id="editSchoolName" required placeholder="e.g., Anderson Secondary School">
          </div>

          <div class="form-group">
            <label for="editPrincipalName">Principal Name *</label>
            <input type="text" id="editPrincipalName" required placeholder="e.g., Mrs. Tan Bee Leng">
          </div>

          <div class="form-group full-width">
            <label for="editAddress">Address *</label>
            <input type="text" id="editAddress" required placeholder="e.g., 4650 Ang Mo Kio Avenue 6">
          </div>

          <div class="form-group">
            <label for="editPostalCode">Postal Code *</label>
            <input type="text" id="editPostalCode" required pattern="[0-9]{6}" placeholder="e.g., 569842">
            <span class="form-hint">6 digits</span>
          </div>

          <div class="form-group">
            <label for="editZoneCode">Zone Code *</label>
            <select id="editZoneCode" required>
              <option value="">Select zone...</option>
              <option value="NORTH">North</option>
              <option value="SOUTH">South</option>
              <option value="EAST">East</option>
              <option value="WEST">West</option>
              <option value="CENTRAL">Central</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label for="editMainlevelCode">Main Level *</label>
            <select id="editMainlevelCode" required>
              <option value="">Select level...</option>
              <option value="PRIMARY">Primary</option>
              <option value="SECONDARY">Secondary</option>
              <option value="JUNIOR COLLEGE">Junior College</option>
              <option value="CENTRALISED INSTITUTE">Centralised Institute</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="hideEditModal()">Cancel</button>
          <button type="submit" class="btn-primary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
            Update School
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-overlay" onclick="hideDeleteModal()"></div>
    <div class="modal-content" style="max-width: 450px;">
      <div class="modal-header">
        <h3>Delete School</h3>
        <button class="modal-close" onclick="hideDeleteModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <div class="delete-modal-body">
        <p class="delete-warning">
          Are you sure you want to delete <strong id="deleteSchoolName"></strong>?
        </p>
        <div class="delete-info">
          <p>This will permanently delete:</p>
          <ul>
            <li>The school record</li>
            <li>All associated subjects</li>
            <li>All associated CCAs</li>
            <li>All associated programmes</li>
            <li>All distinctive programmes</li>
          </ul>
          <p class="delete-note">This action cannot be undone.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" onclick="hideDeleteModal()">Cancel</button>
        <button type="button" class="btn-danger" onclick="confirmDelete()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
          </svg>
          Delete School
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <div class="toast-content">
      <span id="toastMessage"></span>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>INF2003 Database Systems Project • Built with PostgreSQL (Supabase) + MongoDB Atlas</p>
      <p class="footer-links">
        <a href="#" onclick="showAbout(); return false;">About</a>
        <span>•</span>
        <a href="#" onclick="showHelp(); return false;">Help</a>
      </p>
    </div>
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- Main Script -->
  <script src="script.js"></script>
  
  <!-- Map Script -->
  <script src="map.js"></script>
</body>
</html>